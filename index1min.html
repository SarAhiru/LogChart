<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <!--Chart.jsの読み込み-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.0/chart.min.js"></script>

    <title>Chart.js</title>
</head>

<body>
    
    <p>
      <a href="EnglishSound.html">音声再生</a>
    </p>

    <!--CSVファイルの読み取り-->
    <p>＝CSVファイルの読み取り＝</p>
    <input type="file" name="file" id="file" multiple>
    <br><br>
    

    <script type="text/javascript" src="actor.js"></script>
    <script type="text/javascript" src="lavel.js"></script>

    <!--"drawChart.js"と連携させる(デジタル教科書のログ)-->
    <!--英語　ログ　(棒グラフ)　[機能合計]-->
    <script type="text/javascript" src="totalChart1min.js"></script>
    <!--英語　ログ　(棒グラフ)　[機能合計]-->
    <script type="text/javascript" src="totalChart1min_2.js"></script>
    <!--英語　ログ　(棒グラフ)　[機能ごと]-->
    <script type="text/javascript" src="targetEnChart1min.js"></script>
    <!--英語　ログ　人数合計(棒グラフ)　[全体]-->
    <script type="text/javascript" src="numChart1min.js"></script>

    <h1>個人表示</h1>
    <div>
      <p>＝児童ごとの操作回数の合計＝</p>
      <!--<div style="width:50%;"></div>-->
      <canvas id="myCharttt" width="300" height="150"></canvas>
    </div>

    <h1>全体表示</h1>
    <div>
      <p>＝回数グラフの表示 [全体合計](棒グラフ)＝</p>
      <!--<div style="width:50%;"></div>-->
      <canvas id="myChart" width="2500" height="350"></canvas>
    </div>
    <br><br>

    <div>
      <p>＝機能ごとの操作回数の合計＝</p>
      <canvas id="myChart1" width="300" height=" 150"></canvas>
    </div>
    <div>
      <p>＝操作人数の合計＝</p>
      <canvas id="myChart2" width="300" height=" 150"></canvas>
    </div>
    <br><br>

    
    <!--<script type="text/javascript" src="main.js"></script>-->

    <!--以下でデータの読み込みを行う-->
    <script>
        console.log("通過しました!!!");
        let result = []; //csvの中身
        let dataLength = 0; //データの長さ
        let member = [];
        let time = [];
        //drawChart(result[0]);
        
        drawCharttt(result, dataLength, member, time); //データと長さを持ってdrawChart関数に移動(これは最初の軸を作成するのみ)
        drawChart(result, dataLength, member, time);
        drawChartTarget(result, dataLength, member, time);
        drawChart2(result, dataLength, member, time);

        let fileInput = document.getElementById('file');
        let fileReader = new FileReader();
        fileInput.onchange = () => {
          let file = fileInput.files[0];
          fileReader.readAsText(file, 'Shift_JIS');
        };

        //ファイルを読み取ったら実行
        fileReader.onload = () => {
          var txt = fileReader.result
    
          //読み取ったcsvデータを配列に格納
          //var arr = txt.split("\r\n" || "\n" || "\r");
          var arr = txt.split("\r\n");
          arr = txt.split("\n");
          //arr = txt.split("\r");
          //var arr = txt.split("\r\n");
          for (var i = 0; i < arr.length; ++i) {
            result[i] = arr[i].split(',');
          }
          //console.log(arr);
          console.log(result);
          
          //逆順
        //   result.reverse();
        //   console.log(result);

          dataLength = arr.length;
          //console.log(dataLength);

          //操作している人を取り出す
          member = actor(result, dataLength);
          //横軸を決定
          time = lavel(result, dataLength);
          //console.log(lavel);

          if (myCharttt) {
              myCharttt.destroy();
          }
          if (myChart) {
              myChart.destroy();
          }
          if (myChart1) {
              myChart1.destroy();
          }
          if (myChart2) {
              myChart2.destroy();
          }
          
          drawCharttt(result, dataLength, member,time);
          drawChart(result, dataLength, member, time); //データと長さを持ってdrawChart関数に移動
          drawChartTarget(result, dataLength, member, time);
          drawChart2(result, dataLength, member, time);
        }
    </script>
    <br><br>
    <!--CSVファイルの内容を表示する-->
    <!--<p>＝CSVファイルの詳細＝</p>-->
    <!--<div id="result"></div>-->
    <!--<script type="text/javascript" src="main.js"></script>-->
    <!--<script type="text/javascript" src="file_read.js"></script>-->
</body>
</html>
